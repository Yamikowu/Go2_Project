# RealSense D435 進階功能 Demo

本文件介紹這週開發的兩個 RealSense D435 進階功能，均可在 **Mac M4** 上穩定運行。

---

## 🌑 1. 夜視模式 (Night Vision)

**檔案**: `camera/demo/night_vision.py`

### 功能說明

利用 D435 的雙紅外線鏡頭 + Emitter 發射器，在 **完全黑暗** 的環境中也能清楚看見物體。

| 功能             | 說明                             |
| ---------------- | -------------------------------- |
| 雙 IR 鏡頭顯示   | 左右眼並排顯示，展示立體視覺原理 |
| Emitter 即時控制 | 開關雷射發射器、調整功率強度     |
| 夜間成像         | 無需任何可見光即可看清環境       |

### 控制鍵

- `E` — 開關 Emitter
- `+/-` — 調整功率
- `Q` — 離開

### 執行方式

```bash
sudo /Users/yamiko/Documents/VsCode/Go2_Project/.venv/bin/python \
     /Users/yamiko/Documents/VsCode/Go2_Project/camera/demo/night_vision.py
```

### 🤖 機器狗應用場景

| 場景                    | 說明                                |
| ----------------------- | ----------------------------------- |
| **夜間巡邏**      | 機器狗在關燈的房間/倉庫中自主導航   |
| **床底/櫃底探索** | 進入狹窄黑暗空間時不會撞到障礙物    |
| **安防監控**      | 無需開燈也能偵測入侵者              |
| **VSLAM 定位**    | IR 不受室內燈光顏色干擾，定位更穩定 |

---

## 📏 2. 物件體積測量器 (Object Sizer)

**檔案**: `camera/demo/object_sizer.py`

### 功能說明

使用深度相機測量物件的 **寬 × 高 × 深度**（公分），即時顯示在畫面上。

| 功能         | 說明                             |
| ------------ | -------------------------------- |
| 自動輪廓偵測 | 偵測距離範圍內的物體輪廓         |
| 3D 尺寸計算  | 利用相機內參轉換像素為實際公分   |
| 效能監控     | 整合 PerfMonitor，顯示記憶體/CPU |

### 控制鍵

- `+/-` — 調整偵測距離範圍
- `R` — 重設 
- `Q` — 離開

### 執行方式

```bash
sudo /Users/yamiko/Documents/VsCode/Go2_Project/.venv/bin/python \
     /Users/yamiko/Documents/VsCode/Go2_Project/camera/demo/object_sizer.py
```

### 🤖 機器狗應用場景

| 場景                    | 說明                                            |
| ----------------------- | ----------------------------------------------- |
| **智慧避障決策**  | 根據障礙物大小決定繞道、跨越或等待              |
| **門框/通道偵測** | 測量通道寬度，判斷機器狗能否通過                |
| **~~抓取規劃~~** | ~~未來加裝機械爪時，根據物體尺寸規劃抓取姿態~~ |
| **安全距離調整**  | 大型障礙物需要更遠的安全距離                    |

---

## 🔓 D435 隱藏功能（上週未提到）

除了基本的 RGB 彩色相機和 Depth 深度相機外，D435 還有許多進階功能：

### 硬體層級

| 功能                         | 說明                                 | 應用場景             |
| ---------------------------- | ------------------------------------ | -------------------- |
| **雙 IR 紅外線鏡頭**   | 獨立輸出左右眼黑白畫面               | 夜視、VSLAM 定位     |
| **Emitter 雷射發射器** | 可調功率 (0-360)，發射不可見散斑圖案 | 白牆測距、夜間成像   |
| **Global Shutter**     | IR/Depth 鏡頭同時曝光，無果凍效應    | 高速移動時深度不變形 |
| **Hardware Sync**      | 多台相機同步觸發                     | 多機 360° 掃描      |

### 軟體濾鏡

| 濾鏡                      | 功能                     | 效果       |
| ------------------------- | ------------------------ | ---------- |
| **Spatial Filter**  | 空間平滑（類似磨皮）     | 邊緣更平滑 |
| **Temporal Filter** | 時間穩定（用前幾幀修補） | 減少閃爍   |
| **Hole Filling**    | 補洞（填滿測不到的黑點） | 畫面更完整 |
| **Decimation**      | 降解析度                 | 加速運算   |

### 預設模式

| 模式                    | 特性               | 適用場景                 |
| ----------------------- | ------------------ | ------------------------ |
| **High Density**  | 盡量填滿畫面       | 避障（寧可誤判也不漏看） |
| **High Accuracy** | 犧牲覆蓋率換精準度 | 3D 掃描                  |
| **Hand**          | 針對近距離手部優化 | 手勢辨識                 |

### 未開發但可行的功能

| 功能                    | 原理                         | 狀態         |
| ----------------------- | ---------------------------- | ------------ |
| **懸崖/跌落偵測** | 偵測地面深度劇烈變化         | 🔜 待開發    |
| **空間觸發器**    | 在 3D 空間中設定虛擬按鈕區域 | 🔜 待開發    |
| **3D 點雲掃描**   | 深度轉點雲，可輸出 PLY 檔    | ✅ 已有 Demo |

---

## 📊 效能表現 (Mac M4)

| Demo     | 記憶體用量 | CPU 用量 |
| -------- | ---------- | -------- |
| 夜視模式 | ~80 MB     | ~15%     |
| 物件測量 | ~130 MB    | ~40%     |

兩者均可穩定運行，無 RGB 相關的 `power state` 錯誤。

---

## 🔮 未來整合方向

1. **夜視 + 避障**：在夜間模式下啟用避障功能
2. **物件測量 + 避障**：根據障礙物大小做智慧決策
3. **移植到 Jetson**：這些 Demo 的邏輯可直接複製到 Jetson 使用

---

## 相關檔案

- [SKILL.md](../.agent/skills/Go2/SKILL.md) — 開發環境指南
- [realsense_d435_features.md](../.agent/skills/Go2/resources/realsense_d435_features.md) — D435 硬體功能參考
