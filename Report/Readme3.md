# 專案進度報告：人臉辨識系統優化與技術解析

**日期**：2026-02-07
**報告人**：Yamiko

---

## 1. 本週核心產出 (Key Achievements)

### 📌 技術選型與評估 (Model Selection)

我們參考了 **GitHub 官方文檔**、**Papers with Code 評測數據**，並在 Mac M4 環境下進行實際壓力測試，總結如下：

- **測試環境**：Mac Mini (M4), Python 3.12
- **評估標準**：Jetson 部署可行性 (ONNX/TensorRT)、推論速度 (FPS)、專案相容性。

| 方 案                     | 優 點                         | 缺 點                                                              | 評估結果             |
| :------------------------ | :---------------------------- | :----------------------------------------------------------------- | :------------------- |
| **DeepFace**        | 功能很全 (整合 Keras/TF)      | **太肥大、慢**，不適合 Jetson 這種邊緣裝置                   | ❌ 淘汰              |
| **MediaPipe**       | 速度極快 (Google)             | 只有「偵測 (Detection)」，**缺乏「識別 (Recognition)」功能** | ❌ 淘汰              |
| **dlib (face_rec)** | API 超級簡單                  | 模型架構較舊，**抗遮擋能力差**，且 GPU 加速設定繁瑣          | ❌ 淘汰              |
| **InsightFace**     | **極致輕量、支援 ONNX** | 支援**TensorRT 加速**，模型選擇多 (大到小都有)，部署彈性大   | ✅**最終選擇** |

---

### ✅ 雙向即時通訊 (Two-way Communication)

- **影像傳輸**：Windows (RealSense) -> Mac (InsightFace 運算)。
- **結果回傳**：Mac 辨識出人名後，即時將文字數據 (`"Hi, Yamiko"`) 傳回 Windows 端顯示。
- **優點**：操作者在 Windows 端就能確認自己是否被成功辨識，無須兩地跑。

### ✅ 效能極致優化 (Performance Optimization)

針對初期測試遇到的卡頓問題，進行了以下改進：

1. **模型輕量化**：將伺服器級模型 (`buffalo_l`, 2GB RAM) 替換為邊緣裝置專用模型 (`buffalo_s`, 300MB RAM)，準確度持平但速度提升 5 倍。
2. **演算法優化**：實作 **Frame Skip (跳幀偵測)**，每 2 幀進行一次 AI 運算，大幅降低 CPU 負擔。
3. **增量資料庫載入**：修正了「每次存檔都重讀硬碟」的 I/O 瓶頸，現在按 `S` 鍵存檔是瞬間完成。

### ✅ 專案可攜性 (Portable Project)

- 解決了 Python 套件與 AI 模型散落在系統各處的問題。
- 現在模型強制下載至專案內部 (`camera/models`)，整個專案資料夾 **Copy & Paste 到任何電腦即可直接執行**。

---

## 2. 技術核心：InsightFace 是如何運作的？

我們選用的 InsightFace 不僅僅是一個「模型」，而是一套完整的 **AI 流水線 (Pipeline)**。這也是為什麼它能比傳統方法更準確的原因。

當相機拍到一張畫面時，系統其實在極短時間內做了 **4 件事**：

### 步驟 1：人臉偵測 (Detection) - 「臉在哪裡？」

- 使用 **RetinaFace** 演算法，先在大畫面中把所有的「人臉框框」找出來。
- 這一步只負責「找臉」，不管「是誰」。

### 步驟 2：關鍵點定位 & 對齊 (Alignment) - 「把臉擺正」

- 找出人臉的 **5 個關鍵點**（雙眼、鼻頭、嘴角）。
- 利用這些點，把歪斜的臉透過幾何變換「轉正」。
- **這很重要**：這就是為什麼你歪頭、側臉，AI 依然認得出來的原因。

### 步驟 3：特徵提取 (Feature Embedding) - 「轉成密碼」

- 使用 **ArcFace** 演算法，將這張轉正的臉，轉換成一串 **512 維的數字密碼 (Vector)**。
- 在這個數學空間裡，同一個人的臉，距離會很近；不同人的臉，距離會很遠。

### 步驟 4：向量比對 (Matching) - 「你是誰？」

- 將剛剛算出來的這串數字，跟我們資料庫 (`faces_db`) 裡已存的數字進行比對。
- 利用 **餘弦相似度 (Cosine Similarity)** 計算分數。
- 如果分數 > 0.45，我们就判定他是 Yamiko；否則就是 Unknown。

---

## 3. 遇到的問題與解決方案 (Troubleshooting)

| 問題現象                 | 原因分析                          | 解決方案                                    |
| :----------------------- | :-------------------------------- | :------------------------------------------ |
| **連線失敗**       | Windows 自動連上 VPN 導致 IP 錯誤 | 鎖定實體網卡 IP (`192.168.0.14`)          |
| **Mac 嚴重卡頓**   | 每次存檔都重複讀取舊照片          | 改寫為「增量更新 (Incremental Update)」機制 |
| **硬碟空間佔用大** | 誤用大型模型 (`buffalo_l`)      | 更換為輕量模型 (`buffalo_s`)，體積僅 3MB  |

---

## 4. 下一步計畫 (Next Step)

- **多人同框存檔**：優化 `s` 鍵邏輯，支援一次儲存畫面上的多張人臉。
- **Jetson 部署準備**：目前的 ONNX 架構完全相容於 Jetson，屆時只需開啟 TensorRT 加速即可。
